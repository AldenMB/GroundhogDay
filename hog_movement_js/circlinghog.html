<!DOCTYPE html>
<html>
<head>
<title>Demo Hog Movement</title>
</head>

<style type="text/css">
td{
  color:white;
  background-color:black;
  width:1em;
  height:1em;
  text-align:center;
}
.road{
  background-color:darkred;
}
</style>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js">

</script>
<script type="text/javascript">

Board = function Board(width,height){
  this.width = width;
  this.height = height;
  this.axes = [...Array(height)].map(e => Array(width).fill(''));
}

Board.prototype.render = function render(){
  var board_container = $("#board_container")
  var board_table = $("<table>")
  for (var i=this.height-1;i>=0;i--){
    var tr = $("<tr>")
    for (var j=0;j<this.width;j++){
      var td = $("<td>")
      var element = this.axes[j][i];
      if (element instanceof Flan){
        td.text(arrows[element.direction]);
        td.addClass("road")
      } else if (element === "r") {
        td.addClass("road")
      }
      clickhandlerfactory = function(i,j,board){
        return function(){
          if(board.axes[j][i] === 'r'){
            board.axes[j][i] = '';
          } else if (board.axes[j][i] === ''){
            board.axes[j][i] = 'r'
          }
        }
      }
      td.bind("click",clickhandlerfactory(i,j,this))
      tr.append(td)
    }
    board_table.append(tr)
  }
  board_container.empty()
  board_container.append(board_table)
}


arrows = {
  "N":"↑",
  "E":"→",
  "W":"←",
  "S":"↓"
}

Flan = function Flan(board,x,y,direction){
  this.x = x;
  this.y = y;
  this.direction = direction;
  this.board = board;
  this.board.axes[x][y] = this;
}

function mod(m,n){
  return (m%n + n)%n;
}

Flan.prototype.step = function step(){
  adjacents = [[mod(this.x+1,this.board.width),this.y],
               [this.x,mod(this.y-1,this.board.height)],
               [mod(this.x-1,this.board.width),this.y],
               [this.x,mod(this.y+1,this.board.height)]];

  forwardindex = {"E":0,
                  "S":1,
                  "W":2,
                  "N":3}[this.direction]
  
  adjacents.push.apply(adjacents, adjacents.splice(0,forwardindex))

  for (i=0;i<4;i++){
    var newx = adjacents[i][0];
    var newy = adjacents[i][1];
    if (this.board.axes[newx][newy] === 'r'){
      this.board.axes[this.x][this.y] = 'r'
      this.x = newx;
      this.y = newy;
      this.board.axes[newx][newy] = this;
      break;
    }
  }
}

b = new Board(5,5);

b.axes[2][1]="r";
b.axes[3][2]="r";

f = new Flan(b,2,2,"N");

setInterval(function(){
  f.step()
  b.render()
  },500)



</script>

<body>
 <div id="board_container">

 </div>
</body>

</html>
